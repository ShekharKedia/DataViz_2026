ggplot(aes(x = partner_name, y = log_import)) +
geom_boxplot(alpha = 0.7, coef = 1.5, width = 0.4) +
labs(x = "\nPartner", y = "Log import\n")
View(us_trade)
# Violin + jitter: Same data with individual shipments
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = partner_name, y = log_import)) +
geom_violin(alpha = 0.7, width = 0.8, draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_jitter(width = 0.15, alpha = 0.6, size = 0.8) +
labs(x = "\nPartner", y = "Log import\n")
# Violin + jitter: Same data with individual shipments
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = partner_name, y = log_import)) +
geom_violin(alpha = 0.4, width = 0.2, draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_jitter(width = 0.15, alpha = 0.6, size = 0.8) +
labs(x = "\nPartner", y = "Log import\n")
# Violin + jitter: Same data with individual shipments
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = partner_name, y = log_import)) +
geom_violin(alpha = 0.7, width = 0.8, draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_jitter(width = 0.15, alpha = 0.4, size = 0.1) +
labs(x = "\nPartner", y = "Log import\n")
# Violin + jitter: Same data with individual shipments
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = partner_name, y = log_import)) +
geom_violin(alpha = 0.7, width = 0.8, draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_jitter(width = 0.65, alpha = 0.4, size = 0.1) +
labs(x = "\nPartner", y = "Log import\n")
# Violin + jitter: Same data with individual shipments
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = partner_name, y = log_import)) +
geom_violin(alpha = 0.7, width = 0.8, draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_jitter(width = 0.10, alpha = 0.4, size = 0.1) +
labs(x = "\nPartner", y = "Log import\n")
# Violin + jitter: Same data with individual shipments
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = partner_name, y = log_import)) +
geom_violin(alpha = 0.7, width = 0.8, draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_jitter(width = 0.15, alpha = 0.2, size = 0.1) +
labs(x = "\nPartner", y = "Log import\n")
# Distribution exploration:
# Boxplot: Import value distribution by top 5 partners
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = partner_name, y = log_import)) +
geom_boxplot(alpha = 0.7, coef = 1.5, width = 0.4) +
labs(x = "\nPartner", y = "Log import\n")
# Violin + jitter: Same data with individual shipments
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = partner_name, y = log_import)) +
geom_violin(alpha = 0.7, width = 0.8, draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_jitter(width = 0.15, alpha = 0.2, size = 0.1) +
labs(x = "\nPartner", y = "Log import\n")
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(scale = 1.2)
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.2) +
labs(x = "\nLog import", y = "Partner\n")
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.2) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner")
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.2) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner") +
theme_bw()
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.2) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner") +
theme_grey()
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.2) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner") +
theme_minimal()
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.2) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner") +
theme_classic()
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.2) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner")
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.5) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner")
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = trade_value_usd_imp, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.5) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner")+
scale_x_log10()
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = trade_value_usd_imp, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.5) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner")+
scale_x_log100()
# Ridge plot: Partner distributions stacked vertically
us_trade %>%
filter(
partner_name %in% top5_partners_2020$partner_name
) %>%
ggplot(aes(x = log_import, y = partner_name, fill = partner_name)) +
geom_density_ridges(alpha = 0.7, color = "white ", scale = 1.5) +
labs(x = "\nLog import", y = "Partner\n", fill = "Partner")
# Density plot overlay (import vs export)
us_trade <- us_trade %>%
mutate(
log_export = log(trade_value_usd_exp)
)
us_long <- us_trade %>%
filter(year == 2020) %>%
pivot_longer(
cols = c(log_import, log_export),
names_to = "flow",
values_to = "value"
)
ggplot(us_long, aes(x = value, fill = flow)) +
geom_density(alpha = 0.5, color = NA, adjust = 1) +
labs(x = "\nLog value of trade",
y = "Density\n",
title = "Density plot overlay (import vs export)",
fill = "Trade flow")
# Who are the top partners? Create:
# Stacked bar: Top 5 partners' share of total 2020 imports
ggplot(top5_partners_2020,
aes(x = "", y = total_imports, fill = partner_name)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
x = "2020",
y = "Proportion of total imports\n",
fill = "Partner",
title = "Top 5 partners' share of total 2020 imports"
)
# Calculate year-over-year growth
electronics_growth <- electronics %>%
group_by(partner_name, year) %>%
summarize(
total_imports = sum(trade_value_usd_imp, na.rm = TRUE),
.groups = "drop"
) %>%
arrange(partner_name, year) %>%
group_by(partner_name) %>%
mutate(
yoy_growth = (total_imports - lag(total_imports)) / lag(total_imports)
)
View(electronics_growth)
View(electronics_growth)
# Extra questions:
# Which partner shows most growth variability 2018-2020?
##Partner with largest SD of YoY growth across years.
growth_variability <- electronics_growth %>%
filter(!is.na(yoy_growth)) %>%      # remove first year (NA growth)
group_by(partner_name) %>%
summarize(
sd_growth = sd(yoy_growth, na.rm = TRUE),
mean_growth = mean(yoy_growth, na.rm = TRUE),
n_years = n(),
.groups = "drop"
) %>%
arrange(desc(sd_growth))
View(growth_variability)
growth_variability %>% slice_head(n = 1)
# Visualize 2020 US import values:
# Histogram with default bins vs binwidth = 1e9, boundary = 0
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram() +
labs(title = "Default histogram (30 bins)")
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 1e9, boundary = 0) +
labs(title = "Histogram with binwidth = 1e9")
# Log-scale version of best histogram
ggplot(us_trade %>% filter(year == 2020),
aes(log_import)) +
geom_histogram()
View(us_trade)
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram() + scale_x_log10()
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(log_import)) +
geom_histogram()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 5e9, boundary = 0)
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 5e9, boundary = 0) + scale_x_log10()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 1e9, boundary = 0) + scale_x_log10()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 1e8, boundary = 0) + scale_x_log10()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 1e2, boundary = 0) + scale_x_log10()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 1e11, boundary = 0) + scale_x_log10()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 1e8, boundary = 2) + scale_x_log10()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(trade_value_usd_imp)) +
geom_histogram(binwidth = 1e8, boundary = 5) + scale_x_log10()
# What binwidth best reveals the import value distribution?
##One that: Reveals skew; Avoids spike noise;
##Usually log-scale + wide bins
ggplot(us_trade %>% filter(year == 2020),
aes(log_import)) +
geom_histogram()
electronics_2020 <- electronics %>%
filter(year == 2020) %>%
group_by(partner_name) %>%
summarize(
total_imports = sum(trade_value_usd_imp, na.rm = TRUE),
.groups = "drop"
)
ggplot(electronics_2020,
aes(x = "", y = total_imports, fill = partner_name)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
x = "",
y = "Share of HS85 imports",
fill = "Partner",
title = "Partner share of US electronics imports (2020)"
)
electronics_2020 <- electronics %>%
filter(year == 2020,
partner_name %in% top5_partners_2020) %>%
group_by(partner_name) %>%
summarize(
total_imports = sum(trade_value_usd_imp, na.rm = TRUE),
.groups = "drop"
)
ggplot(electronics_2020,
aes(x = "", y = total_imports, fill = partner_name)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
x = "",
y = "Share of HS85 imports",
fill = "Partner",
title = "Partner share of US electronics imports (2020)"
)
View(top5_partners_2020)
partner_name %in% top5_partners_2020
partner_name %in% top5_partners_2020$partner_name
View(top5_partners_2020)
electronics_2020 <- electronics %>%
filter(year == 2020,
partner_name %in% top5_partners_2020$partner_name) %>%
group_by(partner_name) %>%
summarize(
total_imports = sum(trade_value_usd_imp, na.rm = TRUE),
.groups = "drop"
)
View(electronics_2020)
ggplot(electronics_2020,
aes(x = "", y = total_imports, fill = partner_name)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
x = "",
y = "Share of HS85 imports",
fill = "Partner",
title = "Partner share of US electronics imports (2020)"
)
electronics_2020 <- electronics %>%
filter(year == 2020,
partner_name %in% top5_partners_2020$partner_name) %>%
group_by(partner_name) %>%
summarize(
total_imports = sum(log_import, na.rm = TRUE),
.groups = "drop"
)
ggplot(electronics_2020,
aes(x = "", y = total_imports, fill = partner_name)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
x = "",
y = "Share of HS85 imports",
fill = "Partner",
title = "Partner share of US electronics imports (2020)"
)
View(electronics_2020)
electronics_2020 <- electronics %>%
filter(year == 2020,
partner_name %in% top5_partners_2020$partner_name) %>%
group_by(partner_name) %>%
summarize(
total_imports = sum(trade_value_usd_imp, na.rm = TRUE),
.groups = "drop"
)
ggplot(electronics_2020,
aes(x = "", y = total_imports, fill = partner_name)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
x = "",
y = "Share of HS85 imports",
fill = "Partner",
title = "Partner share of US electronics imports (2020)"
)
ggplot(electronics_2020,
aes(y = total_imports, fill = partner_name)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
x = "",
y = "Share of HS85 imports",
fill = "Partner",
title = "Partner share of US electronics imports (2020)"
)
ggplot(electronics_2020,
aes(x = "", y = total_imports, fill = partner_name)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
x = "",
y = "Share of HS85 imports",
fill = "Partner",
title = "Partner share of US electronics imports (2020)"
)
ggplot(electronics %>% filter(year == 2020),
aes(x = trade_value_usd_imp,
y = partner_name,
fill = partner_name)) +
geom_density_ridges(scale = 1.2, alpha = 0.7) +
scale_x_log10() +
labs(
x = "Import value (log scale)",
y = "Partner",
title = "Distribution of electronics import values by partner"
)
ggplot(electronics %>% filter(year == 2020),
aes(x = log_import,
y = partner_name,
fill = partner_name)) +
geom_density_ridges(scale = 1.2, alpha = 0.7) +
labs(
x = "Import value (log scale)",
y = "Partner",
title = "Distribution of electronics import values by partner"
)
ggplot(electronics_2020 %>% filter(year == 2020),
aes(x = log_import,
y = partner_name,
fill = partner_name)) +
geom_density_ridges(scale = 1.2, alpha = 0.7) +
labs(
x = "Import value (log scale)",
y = "Partner",
title = "Distribution of electronics import values by partner"
)
ggplot(electronics_2020,
aes(x = log_import,
y = partner_name,
fill = partner_name)) +
geom_density_ridges(scale = 1.2, alpha = 0.7) +
labs(
x = "Import value (log scale)",
y = "Partner",
title = "Distribution of electronics import values by partner"
)
ggplot(electronics %>%
filter(year == 2020,
partner_name %in% top5_partners_2020$partner_name),
aes(x = log_import,
y = partner_name,
fill = partner_name)) +
geom_density_ridges(scale = 1.2, alpha = 0.7) +
labs(
x = "Import value (log scale)",
y = "Partner",
title = "Distribution of electronics import values by partner"
)
ggplot(electronics %>%
filter(year == 2020,
partner_name %in% top5_partners_2020$partner_name),
aes(x = log_import,
y = partner_name)) +
geom_density_ridges(scale = 1.2, alpha = 0.7) +
labs(
x = "Import value (log scale)",
y = "Partner",
title = "Distribution of electronics import values by partner"
)
ggplot(electronics %>%
filter(year == 2020,
partner_name %in% top5_partners_2020$partner_name),
aes(x = log_import,
y = partner_name,
fill = partner_name)) +
geom_density_ridges(scale = 1.2, alpha = 0.7) +
labs(
x = "Import value (log scale)",
y = "Partner",
fill = "Partner",
title = "Distribution of electronics import values by partner"
)
